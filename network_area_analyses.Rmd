---
title: "MS Network Area AF"
author: "Carine Emer"
date: "12/12/2018"
output: html_document
---

updating code from "metanetwork analyses March 2017.Rmd"(setwd("~/Dropbox/Seed dispersal data Atlantic/updated names/quanti")


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r set working directory}
setwd("~/Dropbox/MS network area AF/Analyses/network_area")
```


```{r packages}
library(bipartite); library(vegan); library(MuMIn)
library(lme4);library(nlme); library(fossil)
```

```{r input data}
setwd("~/Dropbox/MS network area AF/Analyses/network_area/data")
restoredPira<-read.csv("vivian quanti.csv",head=T,row.names=1)
fragmentRC<-read.csv("w34 Athie RC.csv",head=T,row.names=1) 
Cardoso<-read.csv("w44 Castro Cardoso.csv",head=T,row.names=1) 
RebioPcAntas<-read.csv("w30 Correia PcAntas.csv",head=T,row.names=1) 
fragmentMG<-read.csv("w36 Fadini MG.csv",head=T,row.names=1) 
restored15<-read.csv("fe15 quanti.csv",head=T,row.names=1) 
restored25<-read.csv("fe25 quanti.csv",head=T,row.names=1) 
restored57<-read.csv("fe57 quanti.csv",head=T,row.names=1) 
StaGenebra<-read.csv("w35 Galetti Pizo.csv",head=T,row.names=1) 
fragmentSP<-read.csv("w32 Hasui.csv",head=T,row.names=1) 
IAnchieta<-read.csv("w28 Kaiser original.csv",head=T,row.names=1) 
FAraucaria<-read.csv("w33 Kindel.csv",head=T,row.names=1) 
Itatiba<-read.csv("pizo quanti.csv",head=T,row.names=1) 
Intervales<-read.csv("w37 Wesley.csv",head=T,row.names=1)
CBotelho<-read.csv("w95 Botelho.csv",head=T,row.names=1)
fragmentRJ<-read.csv("w93 Rafael UFRJ.csv",head=T,row.names=1)


data<-read.csv("final_results_communities.csv", header=T) # original = CArdoso and Anchieta without added data on E. edulis, Clusia and Cryptocharia, removed all Psittacidae

```

```{r modularity}
comm<-list(Intervales,CBotelho,Cardoso,RebioPcAntas,IAnchieta,fragmentMG,
           FAraucaria,StaGenebra,Itatiba,fragmentRC,restored57,
           restored15,restored25,fragmentSP,restoredPira,fragmentRJ)

mod<-sapply(comm,computeModules)
mod[[1]]
mod_comm<-c(mod[[1]]@likelihood,mod[[2]]@likelihood,mod[[3]]@likelihood,mod[[4]]@likelihood,mod[[5]]@likelihood,mod[[6]]@likelihood,mod[[7]]@likelihood,mod[[8]]@likelihood,mod[[9]]@likelihood,mod[[10]]@likelihood,mod[[11]]@likelihood,mod[[12]]@likelihood,mod[[13]]@likelihood,mod[[14]]@likelihood,mod[[15]]@likelihood,mod[[16]]@likelihood)


```

```{r metrics}
#### connectance, wnodf, modularity, 
#H2 is correlated with modularity


plot(log(data$linkdens))
loglinkdens<-log(data$linkdens)

c_comm<-sapply(comm,networklevel, index = "connectance")
h2_comm<-sapply(comm,networklevel, index = "H2")
cor.test(c_comm,h2_comm) # 0.14

wc_comm<-sapply(comm,networklevel, index = "weighted connectance")
cor.test(wc_comm,c_comm) # 0.80



wnodf<-sapply(comm, networklevel, index = "weighted NODF")
cor.test(mod_comm,h2_comm) 
plot(wnodf,mod_comm)
plot(wnodf,h2_comm)

str(wnodf)


```

```{r correlations}

plot(data$area)
logarea<-log(data$area)
plot(logarea) # better fit

cor(data$area,data$def2Jac)
plot(data$def2Jac~logarea)


cor(logsize,data$intensity) #0.1
cor(logsize,loglinkdens) #0.9
cor(logsize,logarea) #0.69
cor(logsize,data$dirt_mod_quanti)
cor(logsize,data$c)
cor(logsize,data$wnodf)
cor(data$dirt_mod_quanti,data$h2)


data1<-data[,c(14,19,21,23,25)]
data2<-cbind(data1,logarea)
data2<-cbind(data2,logsize)

pairs(data2, pch = 19)


```


```{r sampling completeness}
str(comm)
chao<-sapply(comm, chao1)
chao


save.image("network_area.RData")
```

```{r models}
####logs= log size of the network and logarea = log(area)
plot((data$size))
logsize<-log(data$size) ## better fit
plot(logsize)

plot(data$area)
logarea<-log(data$area)
plot(logarea) # better fit

################animals##########################
#animals
hist(data$n.animals)
hist(log(data$n.animals))
animals<-log(data$n.animals)
## first, REML to compare fixed terms and variable random or correlation structure -Zuur p 90 e 169
m1<-gls(animals ~ logs+logarea+forest.type, data=data,method="REML")# 
#m2<-gls(plants ~ logs+def2Jac*logarea, data=data,method="REML")

m1a<-update(m1,correlation=corSpher(form=~x+y))
m1b<-update(m1,correlation=corLin(form=~x+y))
m1c<-update(m1,correlation=corRatio(form=~x+y))
m1d<-update(m1,correlation=corGaus(form=~x+y))
m1e<-update(m1,correlation=corExp(form=~x+y))

AIC(m1,m1a,m1b,m1c,m1d,m1e) ### m1 best model

### second, fit ML for best model selection Zuur, pg 90
m1<-gls(animals~ intensity+logarea+forest.type, data=data, method="ML", correlation=corSpher(form=~x+y))
summary(m1)
dd<-dredge(m1)
print(dd)
summary(get.models(dd,1)[[1]])

## finally, refit best models with REML for final results
m1best<-m1<-gls(animals~ logarea, data=data, method="REML", correlation=corSpher(form=~x+y))
summary (m1best)

###############plants##########################
#plants
hist(data$n.plants)
hist(log(data$n.plants))
plants<-log(data$n.plants)
## first, REML to compare fixed terms

m1<-gls(plants ~ intensity+logarea+forest.type, data=data,method="REML")# 
m1<-gls(plants ~ logs+logarea+forest.type, data=data,method="REML")

#AIC(m1,m2)

m1a<-update(m1,correlation=corSpher(form=~x+y))
m1b<-update(m1,correlation=corLin(form=~x+y))
m1c<-update(m1,correlation=corRatio(form=~x+y))
m1d<-update(m1,correlation=corGaus(form=~x+y))
m1e<-update(m1,correlation=corExp(form=~x+y))

AIC(m1,m1a,m1b,m1c,m1d,m1e) ### m1 best model

### second, fit ML for best model selection Zuur, pg 90
m1<-gls(plants~ logsize+logarea+forest.type, data=data, method="ML", correlation=corSpher(form=~x+y))
summary(m1)
dd<-dredge(m1)
print(dd)
summary(get.models(dd,1)[[1]])


## finally, refit best models with REML for final results
m1best<-m1<-gls(plants ~ logarea, data=data, method="REML",correlation=corSpher(form=~x+y))
summary (m1best)

##############interactions###########################
hist(data$n.interactions)
hist(log(data$n.interactions))
interactions<-log(data$n.interactions)

## first, REML to compare fixed terms
m1<-gls(interactions ~ intensity+logarea+forest.type, data=data,method="REML")# 
m1<-gls(interactions ~ logsize+logarea+forest.type, data=data,method="REML")

AIC(m1,m2)

m1a<-update(m1,correlation=corSpher(form=~x+y))
m1b<-update(m1,correlation=corLin(form=~x+y))
m1c<-update(m1,correlation=corRatio(form=~x+y))
m1d<-update(m1,correlation=corGaus(form=~x+y))
m1e<-update(m1,correlation=corExp(form=~x+y))

AIC(m1,m1a,m1b,m1c,m1d,m1e) ### m1 best model

### second, fit ML for best model selection Zuur, pg 90
m1<-gls(interactions~ intensity+logarea+forest.type, data=data, method="ML", correlation=corSpher(form=~x+y))
summary(m1)
dd<-dredge(m1)
print(dd)
summary(get.models(dd,1)[[1]])


## finally, refit best models with REML for final results
m1best<-m1<-gls(interactions ~ logarea+intensity, data=data, method="REML",correlation=corSpher(form=~x+y))
summary (m1best)


##############connectance###########################
hist(data$c)
## first, REML to compare fixed terms
m1<-gls(c ~ intensity+logarea+forest.type, data=data,method="REML")# 
m1<-gls(c ~ logsize+logarea+forest.type, data=data,method="REML")

AIC(m1,m2)

m1a<-update(m1,correlation=corSpher(form=~x+y))
m1b<-update(m1,correlation=corLin(form=~x+y))
m1c<-update(m1,correlation=corRatio(form=~x+y))
m1d<-update(m1,correlation=corGaus(form=~x+y))
m1e<-update(m1,correlation=corExp(form=~x+y))

AIC(m1,m1a,m1b,m1c,m1d,m1e) ### m1 best model

### second, fit ML for best model selection Zuur, pg 90
m1<-gls(h2~ logsize+logarea+forest.type, data=data, method="ML", correlation=corSpher(form=~x+y))
summary(m1)
dd<-dredge(m1)
print(dd)
summary(get.models(dd,1)[[1]])
summary(get.models(dd,2)[[1]])

## finally, refit best models with REML for final results
m1best<-gls(c ~ logsize, data=data, method="REML",correlation=corSpher(form=~x+y))
summary (m1best)




##############modularity###########################
hist(data$dirt_mod_quanti)
## first, REML to compare fixed terms
m1<-gls(dirt_mod_quanti ~ intensity+logarea+forest.type, data=data,method="REML")# 
m1<-gls(dirt_mod_quanti ~ logsize+logarea+forest.type, data=data,method="REML")

AIC(m1,m2)

m1a<-update(m1,correlation=corSpher(form=~x+y))
m1b<-update(m1,correlation=corLin(form=~x+y))
m1c<-update(m1,correlation=corRatio(form=~x+y))
m1d<-update(m1,correlation=corGaus(form=~x+y))
m1e<-update(m1,correlation=corExp(form=~x+y))

AIC(m1,m1a,m1b,m1c,m1d,m1e) ### m1 best model

### second, fit ML for best model selection Zuur, pg 90
m1<-gls(dirt_mod_quanti~ logsize+logarea+forest.type, data=data, method="ML", correlation=corSpher(form=~x+y))
summary(m1)
dd<-dredge(m1)
print(dd)
summary(get.models(dd,1)[[1]])
summary(get.models(dd,2)[[1]])

## finally, refit best models with REML for final results
m1best<-m1<-gls(dirt_mod_quanti ~ logarea, data=data, method="REML",correlation=corSpher(form=~x+y))
summary (m1best)

##############Nestedness###########################
hist(data$wnodf)
## first, REML to compare fixed terms
m1<-gls(wnodf ~ intensity+logarea+forest.type, data=data,method="REML")# 
m1<-gls(wnodf ~ logsize+logarea+forest.type, data=data,method="REML")

AIC(m1,m2)

m1a<-update(m1,correlation=corSpher(form=~x+y))
m1b<-update(m1,correlation=corLin(form=~x+y))
m1c<-update(m1,correlation=corRatio(form=~x+y))
m1d<-update(m1,correlation=corGaus(form=~x+y))
m1e<-update(m1,correlation=corExp(form=~x+y))

AIC(m1,m1a,m1b,m1c,m1d,m1e) ### m1 best model

### second, fit ML for best model selection Zuur, pg 90
m1<-gls(wnodf~ intensity+logarea+forest.type, data=data, method="ML", correlation=corSpher(form=~x+y))
summary(m1)
dd<-dredge(m1)
print(dd)
summary(get.models(dd,1)[[1]])
summary(get.models(dd,2)[[1]])

## finally, refit best models with REML for final results
m1best<-m1<-gls(wnodf ~ logsize, data=data, method="REML",correlation=corSpher(form=~x+y))
summary (m1best)


##############H2###########################
hist(data$h2)

## first, REML to compare fixed terms
m1<-gls(h2 ~ intensity+logarea+forest.type, data=data,method="REML")# 
m1<-gls(h2 ~ logsize+logarea+forest.type, data=data,method="REML")

AIC(m1,m2)

m1a<-update(m1,correlation=corSpher(form=~x+y))
m1b<-update(m1,correlation=corLin(form=~x+y))
m1c<-update(m1,correlation=corRatio(form=~x+y))
m1d<-update(m1,correlation=corGaus(form=~x+y))
m1e<-update(m1,correlation=corExp(form=~x+y))

AIC(m1,m1a,m1b,m1c,m1d,m1e) ### m1 best model

### second, fit ML for best model selection Zuur, pg 90
m1<-gls(h2~ intensity+logarea+forest.type, data=data, method="ML", correlation=corSpher(form=~x+y))
summary(m1)
dd<-dredge(m1)
print(dd)
summary(get.models(dd,1)[[1]])
summary(get.models(dd,2)[[1]])

## finally, refit best models with REML for final results
m1best<-m1<-gls(h2 ~ intensity, data=data, method="REML",correlation=corSpher(form=~x+y))
summary (m1best)
```

